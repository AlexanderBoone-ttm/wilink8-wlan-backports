From aa78ab3cc91dc27fd6456946e7edf47b4e6d1168 Mon Sep 17 00:00:00 2001
Date: Wed, 16 Dec 2015 17:30:40 +0200
Subject: [PATCH 07/25] apply backport SmPL patch
 collateral-evolutions/network/0027-genl-const/genl-const.cocci

---
 drivers/net/wireless/mac80211_hwsim.c |  4 ++--
 net/ieee802154/netlink.c              |  4 ++--
 net/ieee802154/nl802154.c             | 16 ++++++++++------
 net/nfc/netlink.c                     |  4 ++--
 net/wireless/nl80211.c                | 16 ++++++++++------
 5 files changed, 26 insertions(+), 18 deletions(-)

diff --git a/drivers/net/wireless/mac80211_hwsim.c b/drivers/net/wireless/mac80211_hwsim.c
index 4726098..fb86796 100644
--- a/drivers/net/wireless/mac80211_hwsim.c
+++ b/drivers/net/wireless/mac80211_hwsim.c
@@ -570,7 +570,7 @@ enum hwsim_multicast_groups {
 	HWSIM_MCGRP_CONFIG,
 };
 
-static const struct genl_multicast_group hwsim_mcgrps[] = {
+static __genl_const struct genl_multicast_group hwsim_mcgrps[] = {
 	[HWSIM_MCGRP_CONFIG] = { .name = "config", },
 };
 
@@ -3025,7 +3025,7 @@ done:
 }
 
 /* Generic Netlink operations array */
-static const struct genl_ops hwsim_ops[] = {
+static __genl_const struct genl_ops hwsim_ops[] = {
 	{
 		.cmd = HWSIM_CMD_REGISTER,
 		.policy = hwsim_genl_policy,
diff --git a/net/ieee802154/netlink.c b/net/ieee802154/netlink.c
index c8133c0..7b292fe 100644
--- a/net/ieee802154/netlink.c
+++ b/net/ieee802154/netlink.c
@@ -97,7 +97,7 @@ int ieee802154_nl_reply(struct sk_buff *msg, struct genl_info *info)
 	return genlmsg_reply(msg, info);
 }
 
-static const struct genl_ops ieee8021154_ops[] = {
+static __genl_const struct genl_ops ieee8021154_ops[] = {
 	/* see nl-phy.c */
 	IEEE802154_DUMP(IEEE802154_LIST_PHY, ieee802154_list_phy,
 			ieee802154_dump_phy),
@@ -134,7 +134,7 @@ static const struct genl_ops ieee8021154_ops[] = {
 		      ieee802154_llsec_del_seclevel),
 };
 
-static const struct genl_multicast_group ieee802154_mcgrps[] = {
+static __genl_const struct genl_multicast_group ieee802154_mcgrps[] = {
 	[IEEE802154_COORD_MCGRP] = { .name = IEEE802154_MCAST_COORD_NAME, },
 	[IEEE802154_BEACON_MCGRP] = { .name = IEEE802154_MCAST_BEACON_NAME, },
 };
diff --git a/net/ieee802154/nl802154.c b/net/ieee802154/nl802154.c
index 4cad924..f7cdbe2 100644
--- a/net/ieee802154/nl802154.c
+++ b/net/ieee802154/nl802154.c
@@ -26,10 +26,12 @@
 #include "rdev-ops.h"
 #include "core.h"
 
-static int nl802154_pre_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static int nl802154_pre_doit(__genl_const struct genl_ops *ops,
+			     struct sk_buff *skb,
 			     struct genl_info *info);
 
-static void nl802154_post_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static void nl802154_post_doit(__genl_const struct genl_ops *ops,
+			       struct sk_buff *skb,
 			       struct genl_info *info);
 
 /* the netlink family */
@@ -49,7 +51,7 @@ enum nl802154_multicast_groups {
 	NL802154_MCGRP_CONFIG,
 };
 
-static const struct genl_multicast_group nl802154_mcgrps[] = {
+static __genl_const struct genl_multicast_group nl802154_mcgrps[] = {
 	[NL802154_MCGRP_CONFIG] = { .name = "config", },
 };
 
@@ -2099,7 +2101,8 @@ static int nl802154_del_llsec_seclevel(struct sk_buff *skb,
 #define NL802154_FLAG_NEED_WPAN_DEV_UP	(NL802154_FLAG_NEED_WPAN_DEV |\
 					 NL802154_FLAG_CHECK_NETDEV_UP)
 
-static int nl802154_pre_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static int nl802154_pre_doit(__genl_const struct genl_ops *ops,
+			     struct sk_buff *skb,
 			     struct genl_info *info)
 {
 	struct cfg802154_registered_device *rdev;
@@ -2161,7 +2164,8 @@ static int nl802154_pre_doit(const struct genl_ops *ops, struct sk_buff *skb,
 	return 0;
 }
 
-static void nl802154_post_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static void nl802154_post_doit(__genl_const struct genl_ops *ops,
+			       struct sk_buff *skb,
 			       struct genl_info *info)
 {
 	if (info->user_ptr[1]) {
@@ -2179,7 +2183,7 @@ static void nl802154_post_doit(const struct genl_ops *ops, struct sk_buff *skb,
 		rtnl_unlock();
 }
 
-static const struct genl_ops nl802154_ops[] = {
+static __genl_const struct genl_ops nl802154_ops[] = {
 	{
 		.cmd = NL802154_CMD_GET_WPAN_PHY,
 		.doit = nl802154_get_wpan_phy,
diff --git a/net/nfc/netlink.c b/net/nfc/netlink.c
index cea4a79..0410735 100644
--- a/net/nfc/netlink.c
+++ b/net/nfc/netlink.c
@@ -34,7 +34,7 @@
 #include "nfc.h"
 #include "llcp.h"
 
-static const struct genl_multicast_group nfc_genl_mcgrps[] = {
+static __genl_const struct genl_multicast_group nfc_genl_mcgrps[] = {
 	{ .name = NFC_GENL_MCAST_EVENT_NAME, },
 };
 
@@ -1623,7 +1623,7 @@ int nfc_vendor_cmd_reply(struct sk_buff *skb)
 }
 EXPORT_SYMBOL(nfc_vendor_cmd_reply);
 
-static const struct genl_ops nfc_genl_ops[] = {
+static __genl_const struct genl_ops nfc_genl_ops[] = {
 	{
 		.cmd = NFC_CMD_GET_DEVICE,
 		.doit = nfc_genl_get_device,
diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.c
index 3954615..b112b75 100644
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@ -32,9 +32,11 @@ static int nl80211_crypto_settings(struct cfg80211_registered_device *rdev,
 				   struct cfg80211_crypto_settings *settings,
 				   int cipher_limit);
 
-static int nl80211_pre_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static int nl80211_pre_doit(__genl_const struct genl_ops *ops,
+			    struct sk_buff *skb,
 			    struct genl_info *info);
-static void nl80211_post_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static void nl80211_post_doit(__genl_const struct genl_ops *ops,
+			      struct sk_buff *skb,
 			      struct genl_info *info);
 
 /* the netlink family */
@@ -59,7 +61,7 @@ enum nl80211_multicast_groups {
 	NL80211_MCGRP_TESTMODE /* keep last - ifdef! */
 };
 
-static const struct genl_multicast_group nl80211_mcgrps[] = {
+static __genl_const struct genl_multicast_group nl80211_mcgrps[] = {
 	[NL80211_MCGRP_CONFIG] = { .name = NL80211_MULTICAST_GROUP_CONFIG },
 	[NL80211_MCGRP_SCAN] = { .name = NL80211_MULTICAST_GROUP_SCAN },
 	[NL80211_MCGRP_REGULATORY] = { .name = NL80211_MULTICAST_GROUP_REG },
@@ -10625,7 +10627,8 @@ static int nl80211_tdls_cancel_channel_switch(struct sk_buff *skb,
 					 NL80211_FLAG_CHECK_NETDEV_UP)
 #define NL80211_FLAG_CLEAR_SKB		0x20
 
-static int nl80211_pre_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static int nl80211_pre_doit(__genl_const struct genl_ops *ops,
+			    struct sk_buff *skb,
 			    struct genl_info *info)
 {
 	struct cfg80211_registered_device *rdev;
@@ -10694,7 +10697,8 @@ static int nl80211_pre_doit(const struct genl_ops *ops, struct sk_buff *skb,
 	return 0;
 }
 
-static void nl80211_post_doit(const struct genl_ops *ops, struct sk_buff *skb,
+static void nl80211_post_doit(__genl_const struct genl_ops *ops,
+			      struct sk_buff *skb,
 			      struct genl_info *info)
 {
 	if (info->user_ptr[1]) {
@@ -10723,7 +10727,7 @@ static void nl80211_post_doit(const struct genl_ops *ops, struct sk_buff *skb,
 	}
 }
 
-static const struct genl_ops nl80211_ops[] = {
+static __genl_const struct genl_ops nl80211_ops[] = {
 	{
 		.cmd = NL80211_CMD_GET_WIPHY,
 		.doit = nl80211_get_wiphy,
-- 
2.6.3

