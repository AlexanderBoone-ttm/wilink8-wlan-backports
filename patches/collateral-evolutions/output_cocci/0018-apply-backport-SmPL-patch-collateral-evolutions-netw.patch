From b5663cb63f68f759017370cceabea3cd8843feea Mon Sep 17 00:00:00 2001
Date: Wed, 16 Dec 2015 17:31:27 +0200
Subject: [PATCH 18/25] apply backport SmPL patch
 collateral-evolutions/network/0049-no-pfmemalloc/no-pfmemalloc.cocci

---
 drivers/net/ethernet/intel/igb/igb_main.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/intel/igb/igb_main.c b/drivers/net/ethernet/intel/igb/igb_main.c
index b198d67..83fe97f 100644
--- a/drivers/net/ethernet/intel/igb/igb_main.c
+++ b/drivers/net/ethernet/intel/igb/igb_main.c
@@ -6626,7 +6626,11 @@ static void igb_reuse_rx_page(struct igb_ring *rx_ring,
 
 static inline bool igb_page_is_reserved(struct page *page)
 {
-	return (page_to_nid(page) != numa_mem_id()) || page_is_pfmemalloc(page);
+	return (page_to_nid(page) != numa_mem_id())
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(3,6,0)
+ || page_is_pfmemalloc(page)
+#endif /* if LINUX_VERSION_CODE >= KERNEL_VERSION(3,6,0) */
+;
 }
 
 static bool igb_can_reuse_rx_page(struct igb_rx_buffer *rx_buffer,
-- 
2.6.3

